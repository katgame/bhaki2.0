<div class="p-5 border border-gray-200 rounded-2xl dark:border-gray-800 lg:p-6" *ngIf="registrationDetails">
  <div class="flex flex-col gap-6 lg:flex-row lg:items-start lg:justify-between">
    <div class="flex-1">
      <div class="flex items-center justify-between mb-6">
        <h4 class="text-lg font-semibold text-gray-800 dark:text-white/90">
          Registration Details
        </h4>
        <app-button 
          *ngIf="isAdmin"
          size="sm" 
          variant="outline" 
          (btnClick)="openEditModal()"
          className="flex items-center gap-2">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Edit
        </app-button>
      </div>
      <div class="grid grid-cols-1 gap-4 lg:grid-cols-4 lg:gap-7 2xl:gap-x-32">
        <div>
          <p class="mb-2 text-xs leading-normal text-gray-500 dark:text-gray-400">
            Registration Number
          </p>
          <p class="text-sm font-medium text-gray-800 dark:text-white/90">
            {{ registrationDetails?.registration?.registrationNumber   }} 
          </p>
        </div>
        <div>
          <p class="mb-2 text-xs leading-normal text-gray-500 dark:text-gray-400">
            Registration Date
          </p>
          <p class="text-sm font-medium text-gray-800 dark:text-white/90">
            {{ registrationDetails?.registration?.registrationDate ? (registrationDetails?.registration?.registrationDate | date: 'yyyy/MM/dd') : '' }}
          </p>
        </div>

        <div>
          <p class="mb-2 text-xs leading-normal text-gray-500 dark:text-gray-400">
              Commencement Date
          </p>
          <p class="text-sm font-medium text-gray-800 dark:text-white/90">
            {{ registrationDetails?.registration?.commencementDate ? (registrationDetails?.registration?.commencementDate | date: 'yyyy/MM/dd') : '' }}
          </p>
        </div>
        <div>
          <p class="mb-2 text-xs leading-normal text-gray-500 dark:text-gray-400">
           Registered By
          </p>
          <p class="text-sm font-medium text-gray-800 dark:text-white/90">
           {{ registrationDetails?.createBy?.name  || '' }}
          </p>
        </div>
      
        <div>
          <p class="mb-2 text-xs leading-normal text-gray-500 dark:text-gray-400">
           Paid Amount
          </p>
          <p class="text-sm font-medium text-gray-800 dark:text-white/90">
           {{ registrationDetails?.registration?.paidAmount   || '' }}
          </p>
        </div>
        <div>
          <p class="mb-2 text-xs leading-normal text-gray-500 dark:text-gray-400">
            Outstanding Amount
          </p>
          <p class="text-sm font-medium text-gray-800 dark:text-white/90">
           {{ registrationDetails?.registration?.outstandingAmount  || '0' }} 
          </p>
        </div>
        <div>
          <p class="mb-2 text-xs leading-normal text-gray-500 dark:text-gray-400">
            Registration Branch
          </p>
          <p class="text-sm font-medium text-gray-800 dark:text-white/90">
           {{ registrationDetails?.branch?.name   || '' }}
          </p>
        </div>
        <div>
          <p class="mb-2 text-xs leading-normal text-gray-500 dark:text-gray-400">
            Registration Course
          </p>
          <p class="text-sm font-medium text-gray-800 dark:text-white/90">
           {{ registrationDetails?.course?.name  || '' }} 
          </p>
        </div>
        <div>
          <p class="mb-2 text-xs leading-normal text-gray-500 dark:text-gray-400">
            Reciept Reference
          </p>
          <p class="text-sm font-medium text-gray-800 dark:text-white/90">
           {{ registrationDetails?.registration?.recieptReference   || '' }} 
          </p>
        </div>
      </div>
    </div>

  </div>

</div>

<!-- Edit Modal -->
<app-modal [isOpen]="isEditModalOpen" (close)="closeEditModal()" className="relative w-full m-5 sm:m-0 max-w-3xl rounded-3xl bg-white p-6 lg:p-10 dark:bg-gray-900">
  <div>
    <h3 class="text-xl font-semibold text-gray-800 dark:text-white/90 mb-6">
      Edit Registration Details
    </h3>
    
    <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
      <!-- Registration Number -->
      <div>
        <app-label>Registration Number</app-label>
        <app-input-field
          type="text"
          placeholder="Registration Number"
          [disabled]="true"
          [value]="editForm.registrationNumber"
          (valueChange)="editForm.registrationNumber = $event.toString()"
        />
      </div>

      <!-- Registration Date -->
      <div>
        <app-label>Registration Date</app-label>
        <app-date-picker
          id="edit-registration-date"
          placeholder="Select date"
          [defaultDate]="editForm.registrationDate"
          (dateChange)="onDateChange($event)"
        />
      </div>

         <!-- Commencement Date -->
         <div>
          <app-label>Commencement Date</app-label>
          <app-date-picker
            id="edit-commencement-date"
            placeholder="Select date"
            [defaultDate]="editForm.commencementDate"
            (dateChange)="onCommencementDateChange($event)"
          />
        </div>

      <!-- Paid Amount -->
      <div>
        <app-label>Paid Amount</app-label>
        <app-input-field
          type="number"
          placeholder="Paid Amount"
          [value]="editForm.paidAmount"
          (valueChange)="editForm.paidAmount = $event"
        />
      </div>

      <!-- Outstanding Amount -->
      <div>
        <app-label>Outstanding Amount</app-label>
        <app-input-field
          type="number"
          placeholder="Outstanding Amount"
          [value]="editForm.outstandingAmount"
          (valueChange)="editForm.outstandingAmount = $event"
        />
      </div>

      <!-- Registration Branch -->
      <div>
        <app-label>Registration Branch</app-label>
        <app-select
          [options]="branchOptions"
          [value]="editForm.branchId"
          (valueChange)="onBranchChange($event)"
          placeholder="Select Branch"
        />
      </div>

      <!-- Registration Course -->
      <div>
        <app-label>Registration Course</app-label>
        <app-select
          [options]="courseOptions"
          [value]="editForm.courseId"
          (valueChange)="editForm.courseId = $event"
          placeholder="Select Course"
        />
      </div>

      <!-- Receipt Reference -->
      <div class="sm:col-span-2">
        <app-label>Receipt Reference</app-label>
        <app-input-field
          type="text"
          placeholder="Receipt Reference"
          [value]="editForm.receiptReference"
          (valueChange)="editForm.receiptReference = $event.toString()"
        />
      </div>
    </div>

    <!-- Modal Actions -->
    <div class="flex items-center justify-end gap-3 mt-8">
      <app-button
        size="md"
        variant="outline"
        [disabled]="isSaving"
        (btnClick)="closeEditModal()"
      >
        Cancel
      </app-button>
      <app-button
        size="md"
        variant="primary"
        [disabled]="isSaving"
        (btnClick)="saveChanges()"
      >
        @if (isSaving) {
          <span>Saving...</span>
        } @else {
          <span>Save Changes</span>
        }
      </app-button>
    </div>
  </div>
</app-modal>
